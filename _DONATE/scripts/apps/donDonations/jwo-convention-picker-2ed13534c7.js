!function(){function n(){return{restrict:"E",templateUrl:"apps/donDonations/jwo-convention-picker.html",controller:"jwoConventionPickerController",controllerAs:"ctrl",bindToController:!0,scope:{api:"="}}}function e(n,e,o,t,i,a,g){function r(n){var e=new RegExp("^"+h.cityOrVenue,"gi");return null!=n.conventionName.match(e)||null!=n.venueName.match(e)}function u(n){if(!n||!n.weekday||!n.time)return"";var e=new Date;e.setUTCDate(e.getUTCDate()-e.getUTCDay()+n.weekday);var o=n.time.split(":");return e.setUTCHours(o[0],o[1],0,0),t("formatDate")(e,"WEEKDAY_TIME",!0)}function c(){return h.deferredConvention=o.defer(),l(),h.deferredConvention.promise}function s(){if(h.languages=[],h.conventionLocationCode){var n=h.conventionLanguageCode||a.userLanguageCode,o={country:h.conventionLocationCode,languageCode:h.userLanguageCode};e(i.routes.CONVENTION_LANGUAGES).query(o,function(e){h.languages=e;var o=t("filter")(h.languages,{languageCode:n},!0);return o.length>0?void(h.conventionLanguageCode=n):n!==a.userLanguageCode&&(o=t("filter")(h.languages,{languageCode:a.userLanguageCode},!0),o.length>0)?void(h.conventionLanguageCode=a.userLanguageCode):void(h.languages.length>0&&(h.conventionLanguageCode=h.languages[0].languageCode))})}}function d(){h.conventionLocationCode=null;var n={languageCode:h.userLanguageCode};e(i.routes.CONVENTION_COUNTRIES).query(n,function(n){h.locations=n,t("filter")(h.locations,{countryCode:h.donateCountryCode},!0).length>0?h.conventionLocationCode=h.donateCountryCode:h.locations.length>0&&(h.conventionLocationCode=h.locations[0].countryCode),s()})}function l(){h.searching=!1,h.conventions=[],h.conventionResults=[],h.cityOrVenue="",h.congregationConvention=null,h.congregation=null,h.congregationTypeAhead=null,angular.isDefined(h.formLocation)&&(h.formLocation.$setPristine(),h.formLocation.$setUntouched()),h.visible=!0}function C(n){h.deferredConvention.resolve(n),h.visible=!1}function v(){if(h.showNoResultsMsg=!1,h.conventionLocationCode&&h.conventionLanguageCode){h.searching=!0;var n={country:h.conventionLocationCode,language:h.conventionLanguageCode,languageCode:h.userLanguageCode};e(i.routes.CONVENTIONS).query(n,function(n){h.conventions=n,h.cityOrVenue?h.conventionResults=h.conventions.filter(r):h.conventionResults=n,h.searching=!1,h.showNoResultsMsg=0==h.conventionResults.length})}}function f(){if(h.congregation=null,h.congregationConvention=null,h.showConventionNotFoundMsg=!1,h.showSeriesEndedMsg=!1,angular.isArray(h.congregationTypeAhead)&&1===h.congregationTypeAhead.length){h.congregation=h.congregationTypeAhead[0],h.congregation.midweekMtg=u(h.congregation.midweekMeetingTime),h.congregation.weekendMtg=u(h.congregation.weekendMeetingTime);var n={congGuid:h.congregation.congGuid,languageCode:h.userLanguageCode};h.conventionLookupPending=!0,e(i.routes.CONG_CONVENTION).get(n,function(n){n.hasOwnProperty("conventionGuid")?h.congregationConvention=n:h.showConventionNotFoundMsg=!0,h.conventionLookupPending=!1},function(n){h.conventionLookupPending=!1,h.showConventionNotFoundMsg=!0})}}var h=this;h.returnConvention=C,h.searchConventions=v,h.getLanguages=s,h.getCongConvention=f,h.api={getConvention:c},function(){n.CORE=i,n.t=g,h.donateCountryCode=a.donateCountryCode,h.cityOrVenue="",h.languages=[],h.locations=[],h.conventionResults=[],h.deferredConvention=null,h.showNoResultsMsg=!1,h.showConventionNotFoundMsg=!1,h.showSeriesEndedMsg=!1,h.userLanguageCode=a.userLanguageCode,d(),n.$watch("ctrl.visible",function(){h.visible||null===h.deferredConvention||h.deferredConvention.reject()}),n.$watch("ctrl.congregationTypeAhead",function(){f()})}()}angular.module("jwoConventionPicker",["jwoModal","jwoTabs","jwoTypeahead","jwoText"]).controller("jwoConventionPickerController",e).directive("jwoConventionPicker",n),e.$inject=["$scope","$resource","$q","$filter","CORE","DATA","LITERALS"]}();
//# sourceMappingURL=../../maps/apps/donDonations/jwo-convention-picker.js.map
